{%extends display.admin%}


{%block pageContent%}


<div class="f">
  <div class="c9 s12 pRa10">
    {{block("iChatList")}}
    {%include 'content_support/ticket/addForm.html'%}

  </div>
  <div class="c3 s12">
    <div class="cbox">
      <div class="msg txtC">{%trans "Ticket No"%} <b>{{masterTicketDetail.id}}</b></div>
      <div class="msg txtC" title='{{masterTicketDetail.datecreated | tdate("Y-m-d H:i:s")}}'>{%trans "Create date"%} <b>{{masterTicketDetail.datecreated | sdate("year")}}</b></div>
      <div class="msg txtC" title='{{dataTable.0.datecreated | tdate("Y-m-d H:i:s")}}'>{%trans "Last activity"%} <b>{{dataTable.0.datecreated | sdate("year")}}</b></div>
      <div class="msg txtC info2">{%trans "Status"%} <b>{%set myStatus =  masterTicketDetail.status%}{%trans myStatus%}</b></div>
      <form method="post">
        <input type="hidden" name="TicketFormType" value="changeStatus">
      <button class="btn block mTB10 success" name="status" value="solved">{%trans "Submit as Solved"%}</button>
  {%if perm('supportTicketView') %}
        <button class="btn block mTB10 secondary"  name="status" value="close">{%trans "Close ticket"%}</button>
  {%endif%}
      </form>

    </div>
{%if perm('supportTicketView') %}
    <div class="cbox">
<!-- do some admin actions -->

      <label for="creator">{%trans "Creator"%}</label>
      <div class="input">
        <input type="text" id="creator" disabled value="{{masterTicketDetail.author}}">
      </div>

      <label for="email">{%trans "Email"%}</label>
      <div class="input">
        <input type="text" id="email" disabled value="{{masterTicketDetail.email}}">
      </div>

      <label for="mobile">{%trans "Mobile"%}</label>
      <div class="input">
        <input type="text" id="mobile" disabled value="{{masterTicketDetail.mobile | fitNumber('mobile')}}">
      </div>

      <form method="post">
        {{block("iTag")}}
        <button class="btn block mTB10 primary"  name="TicketFormType" value="tag">{%trans "Save tag"%}</button>
      </form>
    </div>
{%endif%}

  </div>
</div>
{%endblock%}




{%block iChatList%}

<div class="cbox">
  <div class="msg pain special fs10">{{masterTicketDetail.title}}</div>
  <table class="tbl1 v5">
    <tbody>
{%for key, value in dataTable%}
      <tr class="{{value.rowColor}}" id='msg{{value.id}}'>
        <td class="collapsing">
          <a href="{{url.here}}/ticket&user={{value.user_id}}">
          <img src="{{value.avatar}}" class="avatar mRa10" alt="{{value.displayname}}">
          <span class="txtB s0 fs08">{{value.displayname}}</span>
          </a>
        </td>
        <td class="pRa10">{{value.content | raw | nl2br}}</td>
        <td class="collapsing"><small class="fc-mute">{{value.datecreated | sdate("year")}}</small></td>
      </tr>
{%endfor%}
    </tbody>
  </table>
</div>
{%endblock%}




{%block iTag%}
<div class="tagDetector">
  {%set myID = requestGET.id | coding('encode')%}
{%set postTag = tags({"post_id" : myID , "title" : true, "format" : 'csv', "type" : "support_tag", "related" : "comments"}) %}


  <div class="input mB10 hide">
    <input type="text" class="input tagVals" name="tag" value="{{postTag}}" id="tagValues" placeholder='{%trans "Tag"%}'>
  </div>

  <div class="input" title='{%trans "Add tag manually to link tickets togethers"%}'>
    <input type="text" class="tagInput" placeholder='{%trans "Tag keywords..."%}'>
    <button class="addon tagAdd">+</button>
  </div>
  <div class="tagBox"></div>
</div>
{%endblock%}